<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ä½œæ—¥èªŒ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            background-color: #f9f9f9;
            color: #333;
        }
        h2, h3 {
            color: #444;
        }
        input, button, textarea {
            margin: 5px 0;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 16px;
        }
		#workContent {
			width: 100%;      /* è®“å®ƒæ’æ»¿å®¹å™¨ */
			max-width: 600px; /* é™åˆ¶æœ€å¤§å¯¬åº¦ï¼Œé¿å…éé•· */
			min-height: 10px; /* é©ç•¶é«˜åº¦ï¼Œæ–¹ä¾¿è¼¸å…¥ */
			padding: 8px;
			font-size: 16px;
		}

        button {
            cursor: pointer;
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 10px 15px;
            font-size: 16px;
            border-radius: 8px;
            transition: 0.3s;
        }
        button:hover {
            background-color: #0056b3;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #f1f1f1;
        }
        .section h3 {
            margin-top: 0;
        }
        .btn-group {
            display: flex;
            gap: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #007BFF;
            color: white;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“… JIMMYçš„å·¥ä½œæ—¥èªŒ</h2>

    

    <!-- ğŸ“ æ–°å¢æ—¥èªŒ -->
    <div class="section">
        <h3>ğŸ“ æ–°å¢æ—¥èªŒ</h3>
        <label>æ—¥æœŸ: <input type="date" id="date"></label><br>
		<label>å·¥ä½œå…§å®¹:</label><br>
		<textarea id="workContent" rows="1" style="width: 100%; max-width: 300px;"></textarea><br>
        <label>æ¨™ç±¤: <input type="text" id="tags" placeholder="#é–‹ç™¼ #æœƒè­°"></label><br>
        <button onclick="saveEntry()">ğŸ’¾ å„²å­˜</button>
    </div>
	<!-- ğŸ” ç¯©é¸å€ -->
    <!--<div class="section">
        <h3>ğŸ” ç¯©é¸æ—¥èªŒ</h3>
        <label>é¸æ“‡æ—¥æœŸ: <input type="date" id="searchDate" onchange="filterEntries()"></label>
        <label>æ¨™ç±¤: <input type="text" id="searchTag" oninput="filterEntries()" placeholder="è¼¸å…¥æ¨™ç±¤ #tag"></label>
    </div>-->
    <!-- ğŸ“œ æ—¥èªŒç´€éŒ„ -->
    <div class="section">
        <h3>ğŸ“œ æ—¥èªŒç´€éŒ„</h3>
		<label>é¸æ“‡æ—¥æœŸ: <input type="date" id="searchDate" onchange="filterEntries()"></label>
        <label>æ¨™ç±¤: <input type="text" id="searchTag" oninput="filterEntries()" placeholder="è¼¸å…¥æ¨™ç±¤ #tag"></label>
        <table>
            <thead>
                <tr><th>æ—¥æœŸ</th><th>å·¥ä½œå…§å®¹</th><th>æ¨™ç±¤</th><th>æ“ä½œ</th></tr>
            </thead>
            <tbody id="logTable"></tbody>
        </table>
    </div>

    <!-- ğŸ“Š åŒ¯å‡º / é€±å ± -->
    <div class="section">
        <h3>ğŸ“‚ åŒ¯å‡º</h3>
        <div class="btn-group">
            <button onclick="exportCSV()">ğŸ“‚ åŒ¯å‡º CSV</button>
            <button onclick="exportJSON()">ğŸ“¤ åŒ¯å‡º JSON</button>
            <button onclick="importJSON()">ğŸ“¥ è¼‰å…¥ JSON</button>
            <input type="file" id="fileInput" style="display:none" onchange="handleFileImport(event)">
        </div>
    </div>
	<!-- ğŸ“Š é€±å ±å€å¡Š -->
	<div class="section">
		<h3>ğŸ“Š é€±å ±</h3>
		<label>èµ·å§‹æ—¥æœŸ: <input type="date" id="startDate"></label>
		<label>çµæŸæ—¥æœŸ: <input type="date" id="endDate"></label>
		<button onclick="generateWeeklyReport()">ğŸ“Š ç”Ÿæˆé€±å ±</button>
		<button onclick="closeWeeklyReport()">âŒ é—œé–‰é€±å ±</button>
		<div id="weeklyReport" style="margin-top:10px; display: none;"></div>
	</div>
</div>

<script>
    function setDateToToday() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById("date").value = today;
        document.getElementById("searchDate").value = today;
    }

   
	function saveEntry() {
		const date = document.getElementById("date").value;
		const content = document.getElementById("workContent").value;
		const tags = document.getElementById("tags").value;
		
		if (!date || !content.trim()) {
			return alert("è«‹è¼¸å…¥æ—¥æœŸèˆ‡å·¥ä½œå…§å®¹ï¼");
		}

		const logs = JSON.parse(localStorage.getItem("logs")) || [];
		const entry = {
			id: crypto.randomUUID(),  // ç”¢ç”Ÿå”¯ä¸€ ID
			date: date,
			content: content,
			tags: tags
		};

		logs.push(entry);
		localStorage.setItem("logs", JSON.stringify(logs));
		filterEntries();
	}
	function editEntry(entryId, newValue, field) {
		let logs = JSON.parse(localStorage.getItem("logs")) || [];
		const logIndex = logs.findIndex(log => log.id === entryId);
		
		if (logIndex !== -1) {
			logs[logIndex][field] = newValue;
			localStorage.setItem("logs", JSON.stringify(logs));
		}
	}

    /*function filterEntries() {
        const searchDate = document.getElementById("searchDate").value;
        const searchTag = document.getElementById("searchTag").value.trim();
        const logs = JSON.parse(localStorage.getItem("logs")) || [];

        const filteredLogs = logs.filter(log =>
            log.date === searchDate && (searchTag === "" || log.tags.includes(searchTag))
        );

        const table = document.getElementById("logTable");
        table.innerHTML = filteredLogs.length > 0
            ? filteredLogs.map((log, index) => `
                <tr>
                    <td>${log.date}</td>
                    <td contenteditable="true" onblur="editEntry(${index}, this.innerText, 'content')">${log.content}</td>
                    <td contenteditable="true" onblur="editEntry(${index}, this.innerText, 'tags')">${log.tags}</td>
                    <td><button onclick="deleteEntry(${index})">âŒ åˆªé™¤</button></td>
                </tr>
            `).join('')
            : '<tr><td colspan="4">ğŸ“­ ç„¡æ—¥èªŒç´€éŒ„</td></tr>';
    }*/
	
	function filterEntries() {
		const searchDate = document.getElementById("searchDate").value;
		const searchTag = document.getElementById("searchTag").value.trim();
		const logs = JSON.parse(localStorage.getItem("logs")) || [];

		const filteredLogs = logs.filter(log =>
			log.date === searchDate && (searchTag === "" || log.tags.includes(searchTag))
		);

		const table = document.getElementById("logTable");
		table.innerHTML = filteredLogs.length > 0
			? filteredLogs.map(log => `
				<tr>
					<td>${log.date}</td>
					<td contenteditable="true" onblur="editEntry('${log.id}', this.innerText, 'content')">${log.content}</td>
					<td contenteditable="true" onblur="editEntry('${log.id}', this.innerText, 'tags')">${log.tags}</td>
					<td><button onclick="deleteEntry('${log.id}')">âŒ åˆªé™¤</button></td>
				</tr>
			`).join('')
			: '<tr><td colspan="4">ğŸ“­ ç„¡æ—¥èªŒç´€éŒ„</td></tr>';
	}

    function generateWeeklyReport() {
		const logs = JSON.parse(localStorage.getItem("logs")) || [];
		const startDate = new Date(document.getElementById("startDate").value);
		const endDate = new Date(document.getElementById("endDate").value);

		if (isNaN(startDate) || isNaN(endDate)) {
			return alert("è«‹é¸æ“‡æœ‰æ•ˆçš„æ—¥æœŸç¯„åœï¼");
		}

		endDate.setHours(23, 59, 59, 999); // ç¢ºä¿åŒ…å«æ•´å¤©çš„ç´€éŒ„

		const filteredLogs = logs.filter(log => {
			const logDate = new Date(log.date);
			return logDate >= startDate && logDate <= endDate;
		});

		let reportContent = `<h4>ğŸ“… ${startDate.toDateString()} ~ ${endDate.toDateString()} é€±å ±</h4><ul>`;

		if (filteredLogs.length === 0) {
			reportContent += "<li>ğŸ“­ ç„¡æ—¥èªŒç´€éŒ„</li>";
		} else {
			filteredLogs.forEach(log => {
				reportContent += `<li>ğŸ“… <strong>${log.date}</strong><br>
								  ğŸ“ ${log.content}<br>
								  ğŸ·ï¸ <em>${log.tags}</em></li><hr>`;
			});
		}

		reportContent += "</ul>";
		document.getElementById("weeklyReport").innerHTML = reportContent;
		document.getElementById("weeklyReport").style.display = "block";
	}

	
	function closeWeeklyReport() {
		document.getElementById("weeklyReport").style.display = "none";
	}

    /*function deleteEntry(index) {
		let logs = JSON.parse(localStorage.getItem("logs")) || [];
		logs.splice(index, 1);
		localStorage.setItem("logs", JSON.stringify(logs));
		filterEntries();
	}*/
	
	function deleteEntry(entryId) {
		let logs = JSON.parse(localStorage.getItem("logs")) || [];

		// éæ¿¾æ‰è¦åˆªé™¤çš„ IDï¼Œä¿ç•™å…¶ä»–è³‡æ–™
		logs = logs.filter(log => log.id !== entryId);

		// æ›´æ–° localStorage ä¸¦é‡æ–°è¼‰å…¥è³‡æ–™
		localStorage.setItem("logs", JSON.stringify(logs));
		filterEntries();
	}

	
	function toggleWeeklyReport() {
		const reportDiv = document.getElementById("weeklyReport");
		if (reportDiv.style.display === "none") {
			generateWeeklyReport();
			reportDiv.style.display = "block";
		} else {
			reportDiv.style.display = "none";
		}
	}
	



	function exportJSON() {
		const logs = JSON.parse(localStorage.getItem("logs")) || [];
		if (logs.length === 0) return alert("ç›®å‰æ²’æœ‰å¯åŒ¯å‡ºçš„è³‡æ–™ï¼");

		const blob = new Blob([JSON.stringify(logs, null, 2)], { type: "application/json" });
		const a = document.createElement("a");
		a.href = URL.createObjectURL(blob);
		a.download = "å·¥ä½œæ—¥èªŒ.json";
		document.body.appendChild(a);
		a.click();
		document.body.removeChild(a);
	}

	function importJSON() {
		document.getElementById("fileInput").click();
	}
	function handleFileImport(event) {
		const file = event.target.files[0];
		if (!file) return;

		const reader = new FileReader();
		reader.onload = function(e) {
			try {
				const importedData = JSON.parse(e.target.result);
				localStorage.setItem("logs", JSON.stringify(importedData));
				filterEntries();
				alert("è³‡æ–™æˆåŠŸè¼‰å…¥ï¼");
			} catch (error) {
				alert("è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªæª”æ¡ˆæ ¼å¼æ­£ç¢ºï¼");
			}
		};
		reader.readAsText(file);
	}
	
	function exportCSV() {
		const logs = JSON.parse(localStorage.getItem("logs")) || [];
		if (logs.length === 0) return alert("ç›®å‰æ²’æœ‰å¯åŒ¯å‡ºçš„è³‡æ–™ï¼");

		let csvContent = "æ—¥æœŸ,å·¥ä½œå…§å®¹,æ¨™ç±¤\n" + logs.map(log => `"${log.date}","${log.content}","${log.tags}"`).join("\n");

		const blob = new Blob(["\uFEFF" + csvContent], { type: "text/csv;charset=utf-8;" });
		const a = document.createElement("a");
		a.href = URL.createObjectURL(blob);
		a.download = "å·¥ä½œæ—¥èªŒ.csv";
		document.body.appendChild(a);
		a.click();
		document.body.removeChild(a);
	}
    setDateToToday();
    filterEntries();
	
</script>

</body>
</html>
